<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SwiitchBank - AI-Powered Banking</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #8b5cf6;
      --success: #10b981;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --gray: #64748b;
      --border: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background-color: #f1f5f9;
      color: #0f172a;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-radius: 12px;
      padding: 15px 25px;
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2563eb;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 25px;
    }

    nav a {
      text-decoration: none;
      color: #0f172a;
      font-weight: 500;
      transition: color 0.2s;
    }

    nav a:hover, nav a.active {
      color: #2563eb;
    }

    .auth-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
    }

    .btn-primary {
      background-color: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background-color: #1d4ed8;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #2563eb;
      color: #2563eb;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      padding: 25px;
      margin-bottom: 25px;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #0f172a;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }

    .wallet-card {
      background: linear-gradient(135deg, #2563eb, #8b5cf6);
      color: white;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .wallet-card::after {
      content: '';
      position: absolute;
      top: -50px;
      right: -50px;
      width: 150px;
      height: 150px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
    }

    .wallet-currency {
      font-size: 1.1rem;
      margin-bottom: 5px;
    }

    .wallet-balance {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .card-list {
      display: grid;
      gap: 15px;
    }

    .virtual-card {
      background: linear-gradient(45deg, #4f46e5, #7c3aed);
      color: white;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .card-last-four {
      font-size: 1.5rem;
      letter-spacing: 3px;
      margin: 15px 0;
    }

    .card-info {
      display: flex;
      justify-content: space-between;
    }

    .card-type {
      background: rgba(255,255,255,0.2);
      padding: 3px 8px;
      border-radius: 20px;
      font-size: 0.85rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #2563eb;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      padding: 30px;
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #64748b;
    }

    .notification {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .notification.success {
      background: #dcfce7;
      color: #166534;
    }

    .notification.error {
      background: #fee2e2;
      color: #b91c1c;
    }

    .ai-recommendation {
      background: #f0f9ff;
      border-left: 4px solid #0ea5e9;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .ai-recommendation h3 {
      color: #0c4a6e;
      margin-bottom: 10px;
    }

    .referral-section {
      background: linear-gradient(135deg, #0ea5e9, #8b5cf6);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-top: 25px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // In-memory database
    const createDatabase = () => {
      return {
        users: [
          {
            id: '1',
            email: 'user@swiitchbank.com',
            password: 'password123',
            firstName: 'Test',
            lastName: 'User',
            kycStatus: 'verified'
          }
        ],
        wallets: [
          { id: '1', userId: '1', currency: 'USD', balance: 100.00 },
          { id: '2', userId: '1', currency: 'EUR', balance: 50.00 }
        ],
        cards: [],
        transactions: []
      };
    };

    let db = createDatabase();

    // Mock API functions
    const login = (email, password) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          const user = db.users.find(u => u.email === email && u.password === password);
          if (user) {
            resolve({
              user: {
                id: user.id,
                email: user.email,
                firstName: user.firstName,
                lastName: user.lastName
              },
              token: 'mock_jwt_token'
            });
          } else {
            reject(new Error('Invalid credentials'));
          }
        }, 500);
      });
    };

    const getWalletBalance = (userId) => {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(db.wallets.filter(w => w.userId === userId));
        }, 300);
      });
    };

    const getCards = (userId) => {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve(db.cards.filter(c => c.userId === userId));
        }, 300);
      });
    };

    const issueCard = (userId, currency) => {
      return new Promise((resolve) => {
        setTimeout(() => {
          // Generate mock card data
          const lastFour = Math.floor(1000 + Math.random() * 9000).toString();
          const newCard = {
            id: `card_${Date.now()}`,
            userId,
            lastFour,
            currency,
            cardType: 'virtual',
            status: 'active',
            createdAt: new Date().toISOString()
          };

          db.cards.push(newCard);

          // Deduct card fee
          const wallet = db.wallets.find(w => w.userId === userId && w.currency === currency);
          if (wallet) {
            wallet.balance -= 10;
          }

          resolve({ card: newCard });
        }, 800);
      });
    };

    const topUpWallet = (userId, amount, currency, method) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          let wallet = db.wallets.find(w => w.userId === userId && w.currency === currency);

          if (!wallet) {
            wallet = { id: `wallet_${Date.now()}`, userId, currency, balance: 0 };
            db.wallets.push(wallet);
          }

          wallet.balance += parseFloat(amount);

          db.transactions.push({
            id: `tx_${Date.now()}`,
            userId,
            amount: parseFloat(amount),
            currency,
            type: 'topup',
            method,
            status: 'completed',
            createdAt: new Date().toISOString()
          });

          resolve({ newBalance: wallet.balance });
        }, 700);
      });
    };

    // AI Recommendation Service
    const getAIRecommendations = (userId) => {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            insights: [
              "Based on your spending, you could save $50/month by reducing dining out expenses"
            ],
            offers: [
              "5% cashback on groceries for the next 30 days",
              "0% fee on crypto conversions this week"
            ]
          });
        }, 1000);
      });
    };

    // Main App Component
    function App() {
      const [user, setUser] = useState(null);
      const [page, setPage] = useState('login');
      const [wallets, setWallets] = useState([]);
      const [cards, setCards] = useState([]);
      const [loading, setLoading] = useState(false);
      const [notification, setNotification] = useState(null);
      const [aiData, setAiData] = useState(null);

      const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 5000);
      };

      const handleLogin = async (email, password) => {
        setLoading(true);
        try {
          const data = await login(email, password);
          setUser(data.user);
          localStorage.setItem('user', JSON.stringify(data.user));
          setPage('dashboard');
          showNotification('Login successful!');
        } catch (error) {
          showNotification(error.message, 'error');
        } finally {
          setLoading(false);
        }
      };

      const fetchUserData = async () => {
        if (!user) return;
        setLoading(true);
        try {
          const [walletsData, cardsData, aiRecommendations] = await Promise.all([
            getWalletBalance(user.id),
            getCards(user.id),
            getAIRecommendations(user.id)
          ]);
          setWallets(walletsData);
          setCards(cardsData);
          setAiData(aiRecommendations);
        } catch (error) {
          showNotification('Failed to load data', 'error');
        } finally {
          setLoading(false);
        }
      };

      const handleIssueCard = async (currency) => {
        setLoading(true);
        try {
          await issueCard(user.id, currency);
          await fetchUserData(); // Refresh data
          showNotification('Virtual card issued successfully!');
        } catch (error) {
          showNotification(error.message || 'Card issuance failed', 'error');
        } finally {
          setLoading(false);
        }
      };

      const handleTopUp = async (amount, currency, method) => {
        setLoading(true);
        try {
          await topUpWallet(user.id, amount, currency, method);
          await fetchUserData(); // Refresh data
          showNotification(`Wallet topped up with ${amount} ${currency}!`);
        } catch (error) {
          showNotification(error.message || 'Top-up failed', 'error');
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        const storedUser = localStorage.getItem('user');
        if (storedUser) {
          setUser(JSON.parse(storedUser));
          setPage('dashboard');
        }
      }, []);

      useEffect(() => {
        if (user) {
          fetchUserData();
        }
      }, [user]);

      return (
        <div className="container">
          <Header user={user} setPage={setPage} onLogout={() => {
            localStorage.removeItem('user');
            setUser(null);
            setPage('login');
          }} />

          <main>
            {notification && (
              <div className={`notification ${notification.type}`}>
                {notification.message}
              </div>
            )}

            {page === 'login' && <LoginForm onLogin={handleLogin} onSwitchPage={() => setPage('register')} />}
            {page === 'register' && <RegisterForm onSwitchPage={() => setPage('login')} />}

            {user && (
              <>
                {page === 'dashboard' && <Dashboard wallets={wallets} cards={cards} aiData={aiData} />}
                {page === 'cards' && <CardsPage cards={cards} onIssueCard={handleIssueCard} />}
                {page === 'wallet' && <WalletPage wallets={wallets} onTopUp={handleTopUp} />}
              </>
            )}
          </main>
        </div>
      );
    }

    // Components
    const Header = ({ user, setPage, onLogout }) => (
      <header>
        <div className="logo">SwiitchBank</div>
        {user && (
          <nav>
            <ul>
              <li><a onClick={() => setPage('dashboard')}>Dashboard</a></li>
              <li><a onClick={() => setPage('cards')}>Cards</a></li>
              <li><a onClick={() => setPage('wallet')}>Wallet</a></li>
            </ul>
          </nav>
        )}
        <div className="auth-buttons">
          {user ? (
            <button className="btn btn-outline" onClick={onLogout}>Logout</button>
          ) : (
            <>
              <button className="btn btn-outline" onClick={() => setPage('login')}>Login</button>
              <button className="btn btn-primary" onClick={() => setPage('register')}>Sign Up</button>
            </>
          )}
        </div>
      </header>
    );

    const LoginForm = ({ onLogin, onSwitchPage }) => {
      const [email, setEmail] = useState('user@swiitchbank.com');
      const [password, setPassword] = useState('password123');

      const handleSubmit = (e) => {
        e.preventDefault();
        onLogin(email, password);
      };

      return (
        <div className="card">
          <h2 className="card-title">Login</h2>
          <form onSubmit={handleSubmit}>
            <div className="form-group"><label>Email</label><input type="email" value={email} onChange={(e) => setEmail(e.target.value)} required /></div>
            <div className="form-group"><label>Password</label><input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required /></div>
            <button type="submit" className="btn btn-primary">Login</button>
            <p style={{ marginTop: '15px' }}>Don't have an account? <a href="#" onClick={onSwitchPage}>Sign up</a></p>
          </form>
        </div>
      );
    };

    const RegisterForm = ({ onSwitchPage }) => (
      <div className="card">
        <h2 className="card-title">Create Account</h2>
        <p>Registration is disabled in this demo.</p>
        <p style={{ marginTop: '15px' }}>Already have an account? <a href="#" onClick={onSwitchPage}>Login</a></p>
      </div>
    );

    const Dashboard = ({ wallets, cards, aiData }) => (
      <div className="dashboard-grid">
        <div className="card">
          <h2 className="card-title">Wallets</h2>
          {wallets.map(w => <div className="wallet-card" key={w.id}><div className="wallet-currency">{w.currency}</div><div className="wallet-balance">{w.balance.toFixed(2)}</div></div>)}
        </div>
        <div className="card">
          <h2 className="card-title">AI Insights</h2>
          {aiData && <div className="ai-recommendation"><h3>Recommendations</h3><ul>{aiData.offers.map(o => <li key={o}>{o}</li>)}</ul></div>}
        </div>
      </div>
    );

    const CardsPage = ({ cards, onIssueCard }) => (
      <div className="card">
        <h2 className="card-title">Your Cards</h2>
        <button className="btn btn-primary" onClick={() => onIssueCard('USD')}>Issue New USD Card</button>
        <div className="card-list">
          {cards.map(c => <div className="virtual-card" key={c.id}><div className="card-last-four">•••• •••• •••• {c.lastFour}</div><div className="card-info"><span className="card-currency">{c.currency}</span><span className="card-type">{c.cardType}</span></div></div>)}
        </div>
      </div>
    );

    const WalletPage = ({ wallets, onTopUp }) => {
      const [amount, setAmount] = useState(50);
      const [currency, setCurrency] = useState('USD');

      return (
        <div className="card">
          <h2 className="card-title">Wallet Top-up</h2>
          <div className="form-group"><label>Amount</label><input type="number" value={amount} onChange={e => setAmount(e.target.value)} /></div>
          <div className="form-group"><label>Currency</label><input type="text" value={currency} onChange={e => setCurrency(e.target.value)} /></div>
          <button className="btn btn-primary" onClick={() => onTopUp(amount, currency, 'card')}>Top Up with Card</button>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
